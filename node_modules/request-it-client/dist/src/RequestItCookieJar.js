"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RequestItCookieJar = void 0;
const tough_cookie_1 = require("tough-cookie");
const util_1 = require("util");
class RequestItCookieJar extends tough_cookie_1.CookieJar {
    constructor(store, options) {
        super(store || new tough_cookie_1.MemoryCookieStore(), Object.assign({ rejectPublicSuffixes: false }, options));
        if (this.store && typeof this.store.findCookie === 'function') {
            this.store.findCookie = util_1.promisify(this.store.findCookie.bind(this.store));
        }
        this.getCookieString = util_1.promisify(this.getCookieString.bind(this));
        this.setCookie = util_1.promisify(this.setCookie.bind(this));
    }
    async findCookie(domain, path, key) {
        return await this.store.findCookie(domain, path, key);
    }
    static fromCookieJar(cookieJar) {
        if (cookieJar instanceof RequestItCookieJar)
            return cookieJar;
        const requestItJar = Object.setPrototypeOf(Object.assign(new RequestItCookieJar(), cookieJar), RequestItCookieJar.prototype);
        if (cookieJar.store && typeof cookieJar.store.findCookie === 'function') {
            requestItJar.store.findCookie = util_1.promisify(cookieJar.store.findCookie.bind(cookieJar.store));
        }
        requestItJar.getCookieString = util_1.promisify(cookieJar.getCookieString.bind(requestItJar));
        requestItJar.setCookie = util_1.promisify(cookieJar.setCookie.bind(requestItJar));
        return requestItJar;
    }
}
exports.RequestItCookieJar = RequestItCookieJar;
